<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIZZIAMO?! - La tua pizzeria di fiducia</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/index.css">    <script type="module" src="js/firebase-config.js"></script>
</head>
<body>
    <!-- Header con Logo e Menu Principale -->
    <header>
        <div class="container header-container">
            <div class="logo-contact-container">
                <a href="#" class="logo">
                    <div id="logo-container">
                        <img src="img/logopizzeria.png" alt="PIZZIAMO Logo">
                    </div>
                </a>
                <div class="contact-info">
                    <div class="address">
                        <i class="icon">üìç</i>
                        <span>Via Pontegradella 289/A, 44123 Ferrara (FE)</span>
                    </div>
                    <div class="phone">
                        <i class="icon" style="cursor: pointer;" onclick="adminAccess(event)">üìû</i>
                        <span>Tel: 000000000</span>
                    </div>
                </div>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="chi-siamo.html"><i class="icon">üë•</i> Chi siamo</a></li>
                    <li><a href="menu.html"><i class="icon">üçï</i> Men√π</a></li>
                    <li><a href="https://wbpp.it/o/?900="><i class="icon">üì±</i> Scarica App</a></li>
                </ul>
            </nav>
        </div>
    </header>
    
    <!-- Hero Section -->
    <div class="hero">
        <div class="container hero-container">
            <!-- Carosello -->
            <div class="carousel-container">
                <div class="carousel-slides">
                    <div class="carousel-slide active">
                        <img src="img/pizza1.jpg" alt="Pizza Speciale">
                    </div>
                    <div class="carousel-slide">
                        <img src="img/pizza3.jpg" alt="Offerta Weekend">
                    </div>
                    <div class="carousel-slide">
                        <img src="img/pizza4.jpg" alt="Nuovi Gusti">
                    </div>
                    <div class="carousel-slide">
                        <img src="img/pizza5.jpg" alt="Pizza Speciale">
                    </div>
                    <div class="carousel-slide">
                        <img src="img/pizza.jpg" alt="Pizza Top">
                    </div>
                </div>
                <div class="carousel-controls">
                    <button class="carousel-btn carousel-prev">‚ùÆ</button>
                    <button class="carousel-btn carousel-next">‚ùØ</button>
                </div>
                <div class="carousel-dots">
                    <span class="dot active" data-slide="0"></span>
                    <span class="dot" data-slide="1"></span>
                    <span class="dot" data-slide="2"></span>
                    <span class="dot" data-slide="3"></span>
                    <span class="dot" data-slide="4"></span>
                </div>
            </div>
            
            <!-- Pulsanti Hero -->
            <div class="hero-buttons">
                <a href="https://wbpp.it/o/?900=" target="_blank" class="hero-btn"><i class="icon">üì±</i> Scarica App</a>
                <a href="https://wbpp.it/so/?900" class="hero-btn"><i class="icon">üõí</i> Ordina Subito</a>
                <a href="tel:+39000000000" class="hero-btn mobile-only"><i class="icon">üìû</i> Chiamaci</a>
            </div>
        </div>
    </div>
    
    <!-- Novit√† Section -->
    <section id="novita" class="section">
        <div class="container">
            <h2 class="section-title">Le nostre novit√†</h2>
            <div class="news-container">
                <div class="card">
                    <img src="img/pizza1.jpg" alt="Pizza Stagionale" class="card-img">
                    <div class="card-content">
                        <h3 class="card-title">Pizza Stagionale</h3>
                        <p class="card-text">Scopri la nostra nuova pizza con ingredienti freschi di stagione. Un'esplosione di sapori che ti conquister√†.</p>
                    </div>
                </div>
                <div class="card">
                    <img src="img/pizza3.jpg" alt="Consegna Express" class="card-img">
                    <div class="card-content">
                        <h3 class="card-title">Consegna Express</h3>
                        <p class="card-text">Abbiamo potenziato il nostro servizio di consegna. La tua pizza arriver√† in meno di 30 minuti o √® gratis!</p>
                    </div>
                </div>
                <div class="card">
                    <img src="img/pizza2.jpg" alt="Programma Fedelt√†" class="card-img">
                    <div class="card-content">
                        <h3 class="card-title">Programma Fedelt√†</h3>
                        <p class="card-text">Registrati al nostro programma fedelt√† e ottieni punti ad ogni ordine. I premi ti aspettano!</p>
                        <a href="#" class="btn btn-primary">Iscriviti</a>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </section>
    
    <!-- Come Funziona Section -->
    <section id="come-funziona" class="section">
        <div class="container">
            <div class="how-it-works">
                <h2 class="section-title">Come Funziona?</h2>
            <p class="how-it-works-text">Ordinare la tua pizza preferita √® semplice e veloce con il nostro sistema in 3 passi:</p>
            <div class="steps-container">
                <div class="step-card">
                    <span class="step-number">1</span>
                    <h3>Scarica l'App</h3>
                    <p>Scarica la nostra app gratuita disponibile per iOS e Android.</p>
                </div>
                <div class="step-card">
                    <span class="step-number">2</span>
                    <h3>Scegli il tuo gusto</h3>
                    <p>Sfoglia il menu e personalizza la tua pizza come preferisci.</p>
                </div>
                <div class="step-card">
                    <span class="step-number">3</span>
                    <h3>Ricevi e Gusta</h3>
                    <p>Paga online e attendi la consegna a domicilio o passa a ritirare.</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- App Download Section -->
    <section id="app" class="section">
        <div class="container">
            <h2 class="section-title">Scarica la nostra App</h2>
            <div class="app-container">
                <div class="app-content">
                    <h3>Ordina dove e quando vuoi con l'app PIZZIAMO</h3>
                    <p>L'app PIZZIAMO √® il modo pi√π veloce per ordinare la tua pizza preferita. Disponibile per iOS e Android, ti permette di:</p>
                    <ul>
                        <li>Ordinare in pochi click</li>
                        <li>Salvare i tuoi indirizzi preferiti</li>
                        <li>Tracciare la consegna in tempo reale</li>
                        <li>Accumulare punti fedelt√†</li>
                        <li>Ricevere offerte esclusive</li>
                    </ul>
                    <div class="store-buttons">
                        <a href="https://apps.apple.com/it/app/pizziamo/id1441122313" target="_blank" class="btn btn-primary">App Store</a>
                        <a href="https://play.google.com/store/apps/details?id=net.pizziamo.ordine" target="_blank" class="btn btn-secondary">Google Play</a>
                    </div>
                </div>
                <div class="app-image">
                    <img src="img/qr.png" alt="App PIZZIAMO">
                </div>
            </div>
        </div>
    </section>
    
    <!-- FAQ Section -->
    <section id="faq" class="section">
        <div class="container">
            <div class="faq-section">
                <h2 class="section-title">Domande Frequenti</h2>
            <div class="faq-container">
                <div class="faq-item">
                    <div class="faq-question">Quali zone coprite con la consegna?</div>
                    <div class="faq-answer">
                        <p>Consegniamo in tutta la citt√† e nei comuni limitrofi entro un raggio di 10 km dal nostro locale. Per verificare se la tua zona √® coperta, inserisci il tuo indirizzo nell'app o contattaci direttamente.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Quanto tempo impiegate per la consegna?</div>
                    <div class="faq-answer">
                        <p>I nostri tempi medi di consegna sono di 30-40 minuti, a seconda della distanza e del traffico. Durante i momenti di picco (weekend e serate), potrebbero esserci lievi ritardi. Puoi sempre tracciare lo stato del tuo ordine tramite l'app.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Posso personalizzare la mia pizza?</div>
                    <div class="faq-answer">
                        <p>Assolutamente s√¨! Puoi aggiungere o rimuovere ingredienti dalle nostre pizze standard o creare la tua pizza partendo da zero. Tutte le personalizzazioni sono disponibili nell'app o ordinando telefonicamente.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Avete opzioni per intolleranti o vegani?</div>
                    <div class="faq-answer">
                        <p>S√¨, offriamo opzioni senza glutine, lattosio e completamente vegane. La nostra base senza glutine √® prodotta in ambiente controllato e abbiamo un'ampia selezione di ingredienti vegani. Specifica le tue esigenze al momento dell'ordine.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Team Section -->
    <section id="team" class="section">
        <div class="container">
            <h2 class="section-title" id="teamTitle">Il Nostro Team</h2>
            <p class="section-intro" id="teamIntro">Dietro ogni pizza perfetta c'√® una squadra appassionata e dedicata. Conosciamo le persone che ogni giorno lavorano con passione per offrirti l'esperienza PIZZIAMO?!</p>
            <div class="team-container" id="teamContainer">
                <!-- Team members will be loaded dynamically from Firebase -->
            </div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="footer-column">
                <h3>Contatti</h3>
                <ul>
                    <li>Via Pontegradella 289/A, 44123 Ferrara (FE)</li>
                    <li>Tel: 000000000</li>
                    <li>Email: info@pizziamo.it</li>
                    <li>Orari: 17:00-22:00</li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Link Utili</h3>
                <ul>
                    <li><a href="#">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2025 PIZZIAMO?! Tutti i diritti riservati.</p>
        </div>
    </footer>
    
    <script type="module">
        import { db } from './js/firebase-config.js';
        import { collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        function adminAccess(event) {
            // Verifica se CTRL e SHIFT sono premuti durante il click
            if (event.ctrlKey && event.shiftKey) {
                window.location.href = 'admin.html';
            }
        }
        
        // Rendi la funzione globale per l'onclick inline
        window.adminAccess = adminAccess;

        document.addEventListener('DOMContentLoaded', async function() {
            // CARICAMENTO CAROSELLO DA FIREBASE
            async function loadCarouselFromFirebase() {
                try {
                    const carouselCollection = collection(db, 'carousel');
                    const carouselQuery = query(carouselCollection, orderBy('order'));
                    const querySnapshot = await getDocs(carouselQuery);
                    
                    const slides = [];
                    querySnapshot.forEach((doc) => {
                        slides.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });

                    if (slides.length > 0) {
                        // Popola il carosello con i dati da Firebase
                        const carouselSlidesContainer = document.querySelector('.carousel-slides');
                        const carouselDotsContainer = document.querySelector('.carousel-dots');
                        
                        // Pulisci il contenuto esistente
                        carouselSlidesContainer.innerHTML = '';
                        carouselDotsContainer.innerHTML = '';
                        
                        // Aggiungi le slide
                        slides.forEach((slide, index) => {
                            // Crea slide
                            const slideDiv = document.createElement('div');
                            slideDiv.className = 'carousel-slide' + (index === 0 ? ' active' : '');
                            slideDiv.innerHTML = `<img src="${slide.image}" alt="${slide.alt || 'Slide ' + (index + 1)}">`;
                            carouselSlidesContainer.appendChild(slideDiv);
                            
                            // Crea dot
                            const dot = document.createElement('span');
                            dot.className = 'dot' + (index === 0 ? ' active' : '');
                            dot.setAttribute('data-slide', index);
                            carouselDotsContainer.appendChild(dot);
                        });
                        
                        // Reinizializza il carosello
                        initializeCarousel();
                    }                } catch (error) {
                    console.error("Errore durante il caricamento del carosello:", error);
                    
                    // Se √® un errore di permessi, mantieni le slide di default
                    if (error.code === 'permission-denied') {
                        console.warn("Permessi insufficienti - usando slide di default");
                    } else {
                        console.warn("Errore generico - usando slide di default");
                    }
                    
                    // Inizializza comunque il carosello con le slide HTML esistenti
                    initializeCarousel();
                }
            }

            // Chiama la funzione per caricare il carosello
            await loadCarouselFromFirebase();

            // FUNZIONALIT√Ä CAROSELLO
            function initializeCarousel() {
                const slides = document.querySelectorAll('.carousel-slide');
                const dots = document.querySelectorAll('.dot');
                const prevButton = document.querySelector('.carousel-prev');
                const nextButton = document.querySelector('.carousel-next');
                let currentSlide = 0;
                let autoPlayTimer;
                let isTransitioning = false;
                
                function showSlide(n) {
                    if (isTransitioning) return;
                    isTransitioning = true;
                    
                    if (slides[currentSlide]) {
                        slides[currentSlide].style.opacity = '0';
                        setTimeout(() => {
                            slides[currentSlide].style.display = 'none';
                        }, 300);
                    }
                    
                    dots.forEach(dot => {
                        dot.classList.remove('active');
                    });
                    
                    setTimeout(() => {
                        slides.forEach((slide, i) => {
                            if (i !== n) {
                                slide.style.display = 'none';
                                slide.classList.remove('active');
                            }
                        });
                        
                        slides[n].style.display = 'block';
                        setTimeout(() => {
                            slides[n].style.opacity = '1';
                            slides[n].classList.add('active');
                        }, 50);
                        
                        dots[n].classList.add('active');
                        currentSlide = n;
                        isTransitioning = false;
                    }, 300);
                }
                
                function nextSlide() {
                    let newSlide = currentSlide + 1;
                    if (newSlide >= slides.length) {
                        newSlide = 0;
                    }
                    showSlide(newSlide);
                }
                
                function prevSlide() {
                    let newSlide = currentSlide - 1;
                    if (newSlide < 0) {
                        newSlide = slides.length - 1;
                    }
                    showSlide(newSlide);
                }
                
                prevButton.addEventListener('click', () => {
                    clearInterval(autoPlayTimer);
                    prevSlide();
                    startAutoPlay();
                });
                
                nextButton.addEventListener('click', () => {
                    clearInterval(autoPlayTimer);
                    nextSlide();
                    startAutoPlay();
                });
                
                dots.forEach((dot, index) => {
                    dot.addEventListener('click', () => {
                        if (currentSlide !== index) {
                            clearInterval(autoPlayTimer);
                            showSlide(index);
                            startAutoPlay();
                        }
                    });
                });
                
                function startAutoPlay() {
                    autoPlayTimer = setInterval(nextSlide, 5000);
                }
                
                startAutoPlay();
                
                // Touch support
                const carouselContainer = document.querySelector('.carousel-container');
                let touchStartX = 0;
                let touchEndX = 0;
                
                carouselContainer.addEventListener('touchstart', (e) => {
                    touchStartX = e.changedTouches[0].screenX;
                }, false);
                
                carouselContainer.addEventListener('touchend', (e) => {
                    touchEndX = e.changedTouches[0].screenX;
                    handleSwipe();
                }, false);
                
                function handleSwipe() {
                    const threshold = 50;
                    if (touchEndX < touchStartX - threshold) {
                        clearInterval(autoPlayTimer);
                        nextSlide();
                        startAutoPlay();
                    }
                    if (touchEndX > touchStartX + threshold) {
                        clearInterval(autoPlayTimer);
                        prevSlide();
                        startAutoPlay();
                    }
                }
                
                carouselContainer.addEventListener('mouseenter', () => {
                    clearInterval(autoPlayTimer);
                });
                
                carouselContainer.addEventListener('mouseleave', () => {
                    startAutoPlay();
                });
            }

            // FUNZIONALIT√Ä FAQ
            document.querySelectorAll('.faq-question').forEach(question => {
                question.addEventListener('click', () => {
                    const item = question.parentNode;
                    
                    document.querySelectorAll('.faq-item.active').forEach(activeItem => {
                        if (activeItem !== item) {
                            activeItem.classList.remove('active');
                            const answer = activeItem.querySelector('.faq-answer');
                            answer.style.maxHeight = null;
                        }
                    });
                    
                    item.classList.toggle('active');
                    const answer = item.querySelector('.faq-answer');
                    
                    if (item.classList.contains('active')) {
                        answer.style.display = 'block';
                    } else {
                        setTimeout(() => {
                            answer.style.display = 'none';
                        }, 300);
                    }
                });
            });

            // MOBILE BUTTON VISIBILITY
            function checkMobile() {
                const mobileButton = document.querySelector('.mobile-only');
                if (window.innerWidth <= 768) {
                    mobileButton.style.display = 'flex';
                } else {
                    mobileButton.style.display = 'none';
                }
            }
            
            checkMobile();
            window.addEventListener('resize', checkMobile);
            
            // HEADER SCROLL EFFECT
            let lastScrollTop = 0;
            const header = document.querySelector('header');
            
            window.addEventListener('scroll', () => {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                if (scrollTop > lastScrollTop && scrollTop > 300) {
                    header.style.transform = 'translateY(-100%)';
                } else {
                    header.style.transform = 'translateY(0)';
                }
                
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
            }, false);

            // SMOOTH SCROLL
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        const headerHeight = document.querySelector('header').offsetHeight;
                        const targetPosition = target.getBoundingClientRect().top + window.pageYOffset;
                        
                        window.scrollTo({
                            top: targetPosition - headerHeight - 20,
                            behavior: 'smooth'
                        });
                    }
                });            });

            // TEAM LOADING FROM FIREBASE
            async function loadTeamFromFirebase() {
                try {
                    // Import Firebase modules
                    const { auth, db } = await import('./js/firebase-config.js');
                    const { collection, getDocs, query, where, orderBy } = await import('https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js');
                    
                    // Load team settings
                    const teamSettingsRef = collection(db, 'team-settings');
                    const teamSettingsSnapshot = await getDocs(teamSettingsRef);
                    
                    if (!teamSettingsSnapshot.empty) {
                        const settings = teamSettingsSnapshot.docs[0].data();
                        if (settings.titolo) {
                            document.getElementById('teamTitle').textContent = settings.titolo;
                        }
                        if (settings.introduzione) {
                            document.getElementById('teamIntro').textContent = settings.introduzione;
                        }
                    }
                    
                    // Load team members
                    const teamRef = collection(db, 'team');
                    const teamQuery = query(
                        teamRef, 
                        where('status', '==', 1), // Only active members
                        orderBy('ordine', 'asc')
                    );
                    const teamSnapshot = await getDocs(teamQuery);
                    
                    const teamContainer = document.getElementById('teamContainer');
                    teamContainer.innerHTML = '';
                    
                    teamSnapshot.forEach((doc) => {
                        const member = doc.data();
                        const memberElement = document.createElement('div');
                        memberElement.className = 'team-member';
                        
                        // Build social media links
                        let socialHtml = '';
                        if (member.social) {
                            socialHtml = '<div class="team-social">';
                            if (member.social.facebook) {
                                socialHtml += `<a href="${member.social.facebook}" target="_blank">üìò</a>`;
                            }
                            if (member.social.instagram) {
                                socialHtml += `<a href="${member.social.instagram}" target="_blank">üì∑</a>`;
                            }
                            if (member.social.twitter) {
                                socialHtml += `<a href="${member.social.twitter}" target="_blank">üê¶</a>`;
                            }
                            socialHtml += '</div>';
                        }
                        
                        memberElement.innerHTML = `
                            <img src="${member.image || 'img/team/default.jpg'}" alt="${member.nome}">
                            <h3>${member.nome}</h3>
                            <p style="font-weight: 600; color: var(--primary);">${member.ruolo}</p>
                            <p>${member.descrizione}</p>
                            ${socialHtml}
                        `;
                        
                        teamContainer.appendChild(memberElement);
                    });
                    
                    console.log('Team loaded successfully');
                    
                } catch (error) {
                    console.error('Error loading team from Firebase:', error);
                    // Keep default content if Firebase fails
                }
            }

            // Load team data when page loads
            loadTeamFromFirebase();
        });
    </script>
</body>
</html>